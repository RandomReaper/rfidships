<!DOCTYPE HTML>

<html>
   <head>

      <script type = "text/javascript">
        // âœ… Or create a reusable function
function padTo2Digits(num) {
  return num.toString().padStart(2, '0');
}

function padTo3Digits(num) {
  return num.toString().padStart(3, '0');
}

function convertMsToTime(milliseconds) {
  let ms = milliseconds % 1000;
  let cs = Math.floor(milliseconds/10) % 100;
  let seconds = Math.floor(milliseconds / 1000);
  let minutes = Math.floor(seconds / 60);

  seconds = seconds % 60;
  minutes = minutes % 60;

  return `${padTo2Digits(minutes)}:${padTo2Digits(seconds)}.${padTo2Digits(cs)}`;
}
        let list = new Map();

        function stop(key) {
          list.get(key).stop=Date.now();
        }

         function WebSocketTest() {

            if ("WebSocket" in window) {
               console.log("WebSocket is supported by your Browser!");

               // Let us open a web socket
               var ws = new WebSocket("ws://localhost:1234/");

               ws.onopen = function() {
               };

               ws.onmessage = function (evt) {
                  let r = JSON.parse(evt.data);
                  let now = Date.now()
                  let o = {
                    nr : r.tag,
                    start : now,
                    stop : now
                  }
                  list.set(r.tag, o)
               };

               ws.onclose = function() {

                  // websocket is closed.
                  console.log("Connection is closed...");
               };
            } else {

               // The browser doesn't support WebSocket
               console.log("WebSocket NOT supported by your Browser!");
            }


            setInterval(function() {

              let a = "<table><tr><th>tag</th><th>time</th></tr>"
              let now = Date.now()
              let list1 = new Map();
              for (const [key, value] of list.entries()) {
                list1.set(key, value.stop > value.start ? value.stop-value.start : now-value.start)
              }
              list1 = new Map([...list1.entries()].sort((a, b) => a[1] - b[1]));
              for (const [key, value] of list1.entries()) {
                  a+="<tr>"
                  a+="<td>"+key+"</td>"
                  a+="<td>"+convertMsToTime(value)+"</td>"
                  a+='<td><button onclick="stop(\''+key+'\');">stop</button></td>'
                  a+="</tr>"
                }

              a += "</table>"
              document.getElementById('log').innerHTML = a

              // remove
              list = new Map([...list].filter(([k,v]) => v.start == v.stop || now < v.stop + 2*60*1000 ))

            }, 50);

         }
      </script>

   </head>

   <body onload="WebSocketTest()">
     <div id="log">initial content</div>
   </body>
</html>
